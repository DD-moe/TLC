<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas z IndexedDB</title>
    <script src="https://daybrush.com/moveable/release/latest/dist/moveable.min.js"></script>
    <link rel="stylesheet" href="pushdata.css">
</head>
<body>
    <script>
        // starter script
        function setBodyClassBasedOnScreenSize() {
            const dpi = window.devicePixelRatio || 1;
            const screenWidthInches = (window.innerWidth / dpi) / 96; // 96 dpi as standard
            const screenHeightInches = (window.innerHeight / dpi) / 96;
            const screenDiagonalInches = Math.sqrt(Math.pow(screenWidthInches, 2) + Math.pow(screenHeightInches, 2));
            const screenDiagonalMM = screenDiagonalInches * 25.4; // Convert inches to millimeters
            
            document.body.classList.remove("small-screen", "medium-screen", "large-screen");
            
            if (screenDiagonalMM < 180) { 
                document.body.classList.add("small-screen");
            } else if (screenDiagonalMM >= 180 && screenDiagonalMM < 330) { 
                document.body.classList.add("medium-screen");
            } else {
                document.body.classList.add("large-screen");
            }
        }
        window.onresize = setBodyClassBasedOnScreenSize;
        setBodyClassBasedOnScreenSize();
    </script>

    <div class="controls">
        <h3 id="konsola">konsola: </h3>
    </div>
    <h2>Canvas 1 - Spots</h2>
    <canvas id="spots" width="400" height="400"></canvas>

    <h2>Canvas 2 - Background</h2>
    <canvas id="background" width="400" height="400"></canvas>

    <!-- internalize script --><script src="internalize.js"></script><!-- internalize script -->

    <script>
        // Funkcja do wstawienia obrazu na odpowiedni canvas
        function loadImageToCanvas(dbName, storeName, key, canvasId) {
            // Pobierz URL obrazu z IndexedDB
            getImageUrlFromIndexedDB(dbName, storeName, key).then((imageUrl) => {
                // Znajdź odpowiedni element canvas
                const canvas = document.getElementById(canvasId);
                if (canvas && imageUrl) {
                    const img = new Image();
                    img.onload = () => {
                        // Ustaw rozmiar canvasu na rozmiar obrazu
                        canvas.width = img.width;
                        canvas.height = img.height;

                        // Rysuj obraz na canvas
                        const ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);  // Wstaw obraz na canvas
                    };
                    img.src = imageUrl;  // Ustaw źródło obrazu
                }
            }).catch((error) => {
                console.error('Błąd podczas ładowania obrazu:', error);
            });
        }


        // Ładowanie obrazów na kanwasy po załadowaniu strony
        window.onload = () => {
            const dbName = "TLC";
            const storeName = "data";

            // Załaduj obrazki do odpowiednich canvasów
            loadImageToCanvas(dbName, storeName, "spots", "spots");
            loadImageToCanvas(dbName, storeName, "background", "background");
        };
    </script>     
</body>
</html>
